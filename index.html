<!DOCTYPE html><html lang="ar" dir="rtl">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>محول الصوت إلى نص</title>
    <script src="https://cdn.tailwindcss.com"></script>
  </head>
  <body class="bg-gray-900 text-white min-h-screen flex flex-col items-center p-4">
    <!-- شريط علوي -->
    <div class="w-full flex justify-between items-center mb-4">
      <h1 class="text-xl font-bold">🎤 محول الصوت إلى نص</h1>
      <button id="menuBtn" class="text-2xl">☰</button>
    </div><!-- القائمة الجانبية -->
<div id="sidebar" class="fixed right-0 top-0 h-full w-48 bg-gray-800 p-4 hidden z-50">
  <p class="mb-2">📌 قائمة وهمية:</p>
  <ul class="space-y-2 text-sm">
    <li>معلومة 1</li>
    <li>معلومة 2</li>
    <li>معلومة 3</li>
  </ul>
</div>

<!-- العداد -->
<div id="timer" class="text-sm text-gray-300 mb-2">المدة: 0 ثانية</div>

<!-- منطقة النص -->
<textarea id="transcript" rows="6" class="w-full max-w-2xl p-2 bg-gray-800 rounded mb-4 resize-none"></textarea>

<!-- الأزرار -->
<div class="flex flex-wrap justify-center gap-2 mb-6">
  <button id="startBtn" class="bg-green-600 hover:bg-green-700 px-4 py-2 rounded">ابدأ التسجيل</button>
  <button id="pauseBtn" class="bg-yellow-600 hover:bg-yellow-700 px-4 py-2 rounded">إيقاف مؤقت</button>
  <button id="resumeBtn" class="bg-blue-600 hover:bg-blue-700 px-4 py-2 rounded">استئناف</button>
  <button id="stopBtn" class="bg-red-600 hover:bg-red-700 px-4 py-2 rounded">إيقاف</button>
</div>

<!-- الأرشيف -->
<div class="w-full max-w-2xl">
  <h2 class="text-lg font-semibold mb-2">🗂️ الأرشيف:</h2>
  <div id="archive" class="space-y-3"></div>
</div>

<!-- زر المشاركة -->
<div class="fixed bottom-4">
  <script async src="https://static.addtoany.com/menu/page.js"></script>
  <div class="a2a_kit a2a_default_style">
    <a class="a2a_button_whatsapp"></a>
    <a class="a2a_button_facebook"></a>
    <a class="a2a_button_x"></a>
    <a class="a2a_button_telegram"></a>
  </div>
</div>

<script>
  const transcriptEl = document.getElementById("transcript");
  const archiveEl = document.getElementById("archive");
  const timerEl = document.getElementById("timer");

  let recognition;
  let isRecording = false;
  let isPaused = false;
  let collectedTranscript = "";
  let finalTranscript = "";
  let timerInterval;
  let seconds = 0;
  let lastFinal = "";

  if ('webkitSpeechRecognition' in window) {
    recognition = new webkitSpeechRecognition();
    recognition.lang = 'ar-SA';
    recognition.continuous = true;
    recognition.interimResults = true;

    recognition.onresult = (event) => {
      let interimTranscript = "";
      for (let i = event.resultIndex; i < event.results.length; ++i) {
        const transcript = event.results[i][0].transcript.trim();
        if (event.results[i].isFinal) {
          if (transcript !== lastFinal) {
            collectedTranscript += transcript + " ";
            lastFinal = transcript;
          }
        } else {
          interimTranscript += transcript + " ";
        }
      }
      finalTranscript = collectedTranscript.trim();
      transcriptEl.value = collectedTranscript + interimTranscript;
    };

    recognition.onend = () => {
      if (isRecording && !isPaused) recognition.start();
    }
  }

  function startTimer() {
    timerInterval = setInterval(() => {
      seconds++;
      timerEl.textContent = `المدة: ${seconds} ثانية`;
    }, 1000);
  }

  function stopTimer() {
    clearInterval(timerInterval);
    timerInterval = null;
  }

  document.getElementById("startBtn").onclick = () => {
    if (recognition) {
      isRecording = true;
      isPaused = false;
      collectedTranscript = "";
      lastFinal = "";
      transcriptEl.value = "";
      recognition.start();
      seconds = 0;
      timerEl.textContent = "المدة: 0 ثانية";
      startTimer();
    }
  };

  document.getElementById("pauseBtn").onclick = () => {
    if (recognition && isRecording) {
      isPaused = true;
      recognition.stop();
      stopTimer();
    }
  };

  document.getElementById("resumeBtn").onclick = () => {
    if (recognition && isRecording && isPaused) {
      isPaused = false;
      recognition.start();
      startTimer();
    }
  };

  document.getElementById("stopBtn").onclick = () => {
    if (recognition && isRecording) {
      isRecording = false;
      isPaused = false;
      recognition.stop();
      stopTimer();
      const text = transcriptEl.value.trim();
      if (text) {
        if (confirm("هل تريد حفظ النص في الأرشيف؟")) {
          saveToArchive(text);
        }
      }
    }
  };

  function saveToArchive(text) {
    const archive = JSON.parse(localStorage.getItem("archive") || "[]");
    archive.unshift(text);
    localStorage.setItem("archive", JSON.stringify(archive));
    renderArchive();
  }

  function renderArchive() {
    const archive = JSON.parse(localStorage.getItem("archive") || "[]");
    archiveEl.innerHTML = "";
    archive.forEach((item, i) => {
      const div = document.createElement("div");
      div.className = "bg-gray-800 p-3 rounded flex justify-between items-center text-sm";
      div.innerHTML = `
        <div class="flex-1 cursor-pointer" onclick="editItem(${i})">${item}</div>
        <div class="flex gap-2">
          <button onclick="downloadItem(${i})" class="text-green-400">📥</button>
          <button onclick="deleteItem(${i})" class="text-red-400">🗑️</button>
          <span class="text-gray-400">${archive.length - i}</span>
        </div>
      `;
      archiveEl.appendChild(div);
    });
  }

  window.editItem = function(i) {
    const archive = JSON.parse(localStorage.getItem("archive") || "[]");
    const newText = prompt("تعديل النص:", archive[i]);
    if (newText !== null) {
      archive[i] = newText;
      localStorage.setItem("archive", JSON.stringify(archive));
      renderArchive();
    }
  };

  window.downloadItem = function(i) {
    const archive = JSON.parse(localStorage.getItem("archive") || "[]");
    const blob = new Blob([archive[i]], { type: "text/plain;charset=utf-8" });
    const url = URL.createObjectURL(blob);
    const a = document.createElement("a");
    a.href = url;
    a.download = `نص_${i + 1}.txt`;
    a.click();
    URL.revokeObjectURL(url);
  };

  window.deleteItem = function(i) {
    const archive = JSON.parse(localStorage.getItem("archive") || "[]");
    archive.splice(i, 1);
    localStorage.setItem("archive", JSON.stringify(archive));
    renderArchive();
  };

  document.getElementById("menuBtn").onclick = () => {
    document.getElementById("sidebar").classList.toggle("hidden");
  };

  window.onclick = (e) => {
    const sidebar = document.getElementById("sidebar");
    const menuBtn = document.getElementById("menuBtn");
    if (!sidebar.contains(e.target) && e.target !== menuBtn) {
      sidebar.classList.add("hidden");
    }
  };

  renderArchive();
</script>

  </body>
</html>