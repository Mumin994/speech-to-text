
<html lang="ar" dir="rtl">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>تحويل الصوت إلى نص</title>
    <script defer>
      let mediaRecorder;
      let audioChunks = [];
      let timerInterval;
      let seconds = 0;

      function startRecording() {
        navigator.mediaDevices.getUserMedia({ audio: true }).then((stream) => {
          mediaRecorder = new MediaRecorder(stream);
          audioChunks = [];

          mediaRecorder.addEventListener("dataavailable", (event) => {
            audioChunks.push(event.data);
          });

          mediaRecorder.addEventListener("stop", () => {
            const audioBlob = new Blob(audioChunks);
            const reader = new FileReader();
            reader.onload = () => {
              const text = prompt("النص المستنتج من الصوت:", reader.result.slice(0, 200)) || "نص بدون عنوان";
              const archive = JSON.parse(localStorage.getItem("recordings") || "[]");
              archive.unshift({ text });
              localStorage.setItem("recordings", JSON.stringify(archive));
              displayArchive();
            };
            reader.readAsText(audioBlob);
          });

          mediaRecorder.start();
          document.getElementById("timer").innerText = "المدة: 0 ثانية";
          timerInterval = setInterval(() => {
            seconds++;
            document.getElementById("timer").innerText = `المدة: ${seconds} ثانية`;
          }, 1000);
        });
      }

      function stopRecording() {
        if (mediaRecorder && mediaRecorder.state === "recording") {
          mediaRecorder.stop();
          clearInterval(timerInterval);
          seconds = 0;
          document.getElementById("timer").innerText = "المدة: 0 ثانية";
        }
      }

      function displayArchive() {
        const archive = JSON.parse(localStorage.getItem("recordings") || "[]");
        const list = document.getElementById("archive-list");
        list.innerHTML = "";
        archive.forEach((item, index) => {
          const li = document.createElement("li");
          li.className = "mb-2";
          li.innerHTML = `<span class='font-semibold'>${archive.length - index}. </span> <span onclick="editText(${index})" class='cursor-pointer hover:underline'>${item.text.slice(0, 20)}...</span><br><button onclick="downloadText(${index})" class='text-sm text-green-500 mr-2'>📥</button><button onclick="deleteText(${index})" class='text-sm text-red-500'>🗑️</button>`;
          list.appendChild(li);
        });
      }

      function editText(index) {
        const archive = JSON.parse(localStorage.getItem("recordings") || "[]");
        const current = archive[index];
        const newText = prompt("عدّل النص:", current.text);
        if (newText !== null) {
          archive[index].text = newText;
          localStorage.setItem("recordings", JSON.stringify(archive));
          displayArchive();
        }
      }

      function downloadText(index) {
        const archive = JSON.parse(localStorage.getItem("recordings") || "[]");
        const text = archive[index].text;
        const blob = new Blob(["\uFEFF" + text], { type: "text/plain;charset=utf-8" });
        const link = document.createElement("a");
        link.href = URL.createObjectURL(blob);
        link.download = `تسجيل_${index + 1}.txt`;
        document.body.appendChild(link);
        link.click();
        document.body.removeChild(link);
      }

      function deleteText(index) {
        const archive = JSON.parse(localStorage.getItem("recordings") || "[]");
        archive.splice(index, 1);
        localStorage.setItem("recordings", JSON.stringify(archive));
        displayArchive();
      }

      window.onload = displayArchive;
    </script>
    <script async src="https://static.addtoany.com/menu/page.js"></script>
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/tailwindcss@2.2.19/dist/tailwind.min.css" />
  </head>
  <body class="bg-gray-900 text-white p-4">
    <main class="max-w-xl mx-auto">
      <h1 class="text-2xl font-bold mb-4 text-center">🎤 تحويل الصوت إلى نص</h1>
      <div class="flex justify-center space-x-4 mb-4">
        <button onclick="startRecording()" class="bg-green-600 hover:bg-green-500 px-4 py-2 rounded">▶️ ابدأ التسجيل</button>
        <button onclick="stopRecording()" class="bg-red-600 hover:bg-red-500 px-4 py-2 rounded">⏹️ إيقاف</button>
      </div>
      <div id="timer" class="text-center text-sm text-gray-400 mb-6">المدة: 0 ثانية</div>

      <h2 class="text-xl font-semibold mb-2">📁 الأرشيف</h2>
      <ul id="archive-list"></ul>

      <div class="mt-8 text-center">
        <h3 class="mb-2 text-sm text-gray-400">شارك الموقع على:</h3>
        <div class="a2a_kit a2a_default_style a2a_floating_style a2a_vertical_style">
          <a class="a2a_button_whatsapp"></a>
          <a class="a2a_button_facebook"></a>
          <a class="a2a_button_telegram"></a>
          <a class="a2a_button_twitter"></a>
        </div>
      </div>
    </main>
  </body>
</html>
