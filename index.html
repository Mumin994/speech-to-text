<!DOCTYPE html><html lang="ar" dir="rtl">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Ù…ÙØ­ÙˆÙ‘Ù„ Ø§Ù„ØµÙˆØª Ø¥Ù„Ù‰ Ù†Øµ</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
      body { font-family: system-ui, sans-serif; }
      .container-shadow {
        box-shadow: 0 2px 12px rgba(0,0,0,0.3);
      }
    </style>
  </head>
  <body class="bg-gray-900 text-white min-h-screen flex flex-col items-center p-4">
    <!-- ğŸ§  ÙˆØ§Ø¬Ù‡Ø© Ù…Ø³ØªÙˆØ­Ø§Ø© Ù…Ù† Google Translate -->
    <div class="w-full max-w-3xl bg-gray-800 rounded-lg container-shadow p-4 space-y-4">
      <div class="flex justify-between items-center">
        <h1 class="text-xl font-bold">ğŸ¤ Ù…ÙØ­ÙˆÙ‘Ù„ Ø§Ù„ØµÙˆØª Ø¥Ù„Ù‰ Ù†Øµ</h1>
        <div class="text-sm text-gray-400" id="timer">Ø§Ù„Ù…Ø¯Ø©: 0 Ø«Ø§Ù†ÙŠØ©</div>
      </div>
      <textarea id="transcript" rows="8" class="w-full bg-gray-900 text-white p-3 rounded-lg resize-none border border-gray-700 focus:outline-none focus:ring-2 focus:ring-blue-500" placeholder="Ø³ÙŠØ¸Ù‡Ø± Ø§Ù„Ù†Øµ Ù…Ø¨Ø§Ø´Ø±Ø© Ù‡Ù†Ø§..."></textarea>
      <div class="flex flex-wrap gap-3 justify-start">
        <button id="startBtn" class="bg-blue-600 px-4 py-2 rounded hover:bg-blue-700">ğŸ™ï¸ Ø¨Ø¯Ø¡ Ø§Ù„ØªØ³Ø¬ÙŠÙ„</button>
        <button id="pauseBtn" class="bg-yellow-600 px-4 py-2 rounded hover:bg-yellow-700">â¸ï¸ Ø¥ÙŠÙ‚Ø§Ù Ù…Ø¤Ù‚Øª</button>
        <button id="resumeBtn" class="bg-green-600 px-4 py-2 rounded hover:bg-green-700">â–¶ï¸ Ø§Ø³ØªØ¦Ù†Ø§Ù</button>
        <button id="stopBtn" class="bg-red-600 px-4 py-2 rounded hover:bg-red-700">â¹ï¸ Ø¥ÙŠÙ‚Ø§Ù</button>
      </div>
    </div><!-- ğŸ—‚ï¸ Ø§Ù„Ø£Ø±Ø´ÙŠÙ -->
<div class="w-full max-w-3xl mt-6 space-y-2" id="archive"></div>

<script>
  let mediaRecorder;
  let recognition;
  let isPaused = false;
  let timer;
  let seconds = 0;
  const timerEl = document.getElementById("timer");
  const transcriptEl = document.getElementById("transcript");
  const archiveEl = document.getElementById("archive");
  let records = JSON.parse(localStorage.getItem("records") || "[]");

  function startTimer() {
    timer = setInterval(() => {
      seconds++;
      timerEl.textContent = `Ø§Ù„Ù…Ø¯Ø©: ${seconds} Ø«Ø§Ù†ÙŠØ©`;
    }, 1000);
  }

  function stopTimer() {
    clearInterval(timer);
  }

  function renderArchive() {
    archiveEl.innerHTML = "";
    records.forEach((item, index) => {
      const i = records.length - index;
      const div = document.createElement("div");
      div.className = "bg-gray-800 p-3 rounded-lg flex justify-between items-center gap-2";
      div.innerHTML = `
        <span class="flex-1 cursor-pointer hover:underline" onclick="editText(${index})">${item}</span>
        <div class="flex items-center gap-2">
          <button onclick="downloadText(${index})" class="text-green-400">ğŸ“¥</button>
          <button onclick="deleteText(${index})" class="text-red-400">ğŸ—‘ï¸</button>
          <span class="text-xs text-gray-400">${i}</span>
        </div>
      `;
      archiveEl.appendChild(div);
    });
  }

  function saveToArchive(text) {
    records.unshift(text);
    localStorage.setItem("records", JSON.stringify(records));
    renderArchive();
  }

  function setupSpeechRecognition() {
    const SpeechRecognition = window.SpeechRecognition || window.webkitSpeechRecognition;
    if (!SpeechRecognition) {
      alert("Ø§Ù„Ù…ØªØµÙØ­ Ù„Ø§ ÙŠØ¯Ø¹Ù… Ø§Ù„ØªØ¹Ø±Ù Ø¹Ù„Ù‰ Ø§Ù„ØµÙˆØª Ø¨Ø§Ù„Ø¹Ø±Ø¨ÙŠØ©. Ø§Ø³ØªØ®Ø¯Ù… ÙƒØ±ÙˆÙ… Ø£Ùˆ Ø¥ÙŠØ¯Ø¬.");
      return;
    }
    recognition = new SpeechRecognition();
    recognition.lang = "ar-SA";
    recognition.continuous = true;
    recognition.interimResults = true;

    recognition.onresult = (event) => {
      let interimTranscript = "";
      for (let i = event.resultIndex; i < event.results.length; ++i) {
        const transcript = event.results[i][0].transcript;
        if (event.results[i].isFinal) {
          transcriptEl.value += transcript + " ";
        } else {
          interimTranscript += transcript;
        }
      }
    };

    recognition.onerror = (event) => {
      console.error("Ø®Ø·Ø£ ÙÙŠ Ø§Ù„ØªØ¹Ø±Ù Ø¹Ù„Ù‰ Ø§Ù„ØµÙˆØª:", event.error);
    };
  }

  document.getElementById("startBtn").addEventListener("click", () => {
    transcriptEl.value = "";
    seconds = 0;
    timerEl.textContent = "Ø§Ù„Ù…Ø¯Ø©: 0 Ø«Ø§Ù†ÙŠØ©";
    setupSpeechRecognition();
    recognition.start();
    startTimer();
  });

  document.getElementById("pauseBtn").addEventListener("click", () => {
    if (recognition) {
      recognition.stop();
      stopTimer();
    }
  });

  document.getElementById("resumeBtn").addEventListener("click", () => {
    if (recognition) {
      setupSpeechRecognition();
      recognition.start();
      startTimer();
    }
  });

  document.getElementById("stopBtn").addEventListener("click", () => {
    if (recognition) {
      recognition.stop();
      stopTimer();
      const finalText = transcriptEl.value.trim();
      if (finalText) saveToArchive(finalText);
    }
  });

  window.editText = function(index) {
    const newText = prompt("Ø¹Ø¯Ù‘Ù„ Ø§Ù„Ù†Øµ:", records[index]);
    if (newText !== null) {
      records[index] = newText;
      localStorage.setItem("records", JSON.stringify(records));
      renderArchive();
    }
  }

  window.downloadText = function(index) {
    const blob = new Blob([records[index]], { type: "text/plain;charset=utf-8" });
    const a = document.createElement("a");
    a.href = URL.createObjectURL(blob);
    a.download = `ØªØ³Ø¬ÙŠÙ„_${index + 1}.txt`;
    a.click();
  }

  window.deleteText = function(index) {
    if (confirm("Ù‡Ù„ ØªØ±ÙŠØ¯ Ø­Ø°Ù Ù‡Ø°Ø§ Ø§Ù„ØªØ³Ø¬ÙŠÙ„ØŸ")) {
      records.splice(index, 1);
      localStorage.setItem("records", JSON.stringify(records));
      renderArchive();
    }
  }

  renderArchive();
</script>

  </body>
</html>