<!DOCTYPE html><html lang="ar" dir="rtl">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Ù…Ø­ÙˆÙ„ Ø§Ù„ØµÙˆØª Ø¥Ù„Ù‰ Ù†Øµ</title>
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.rtl.min.css" />
    <style>
      body {
        background-color: #111827;
        color: white;
        padding: 20px;
        font-family: 'Tajawal', sans-serif;
      }
      .btn {
        margin: 5px;
      }
      textarea {
        background-color: #1f2937;
        color: white;
        border: none;
        width: 100%;
        height: 200px;
        padding: 10px;
        resize: none;
        font-size: 1.2em;
      }
      .archive-item {
        background-color: #1f2937;
        padding: 10px;
        border-radius: 10px;
        margin-bottom: 10px;
      }
    </style>
  </head>
  <body>
    <h2 class="text-center">ğŸ¤ Ù…Ø­ÙˆÙ„ Ø§Ù„ØµÙˆØª Ø¥Ù„Ù‰ Ù†Øµ</h2>
    <p class="text-center">Ø§Ù„Ù…Ø¯Ø©: <span id="timer">0</span> Ø«Ø§Ù†ÙŠØ©</p>
    <textarea id="output" readonly></textarea>
    <div class="text-center">
      <button class="btn btn-success" onclick="startRecording()">Ø§Ø¨Ø¯Ø£ Ø§Ù„ØªØ³Ø¬ÙŠÙ„</button>
      <button class="btn btn-warning" onclick="pauseRecording()">Ø¥ÙŠÙ‚Ø§Ù Ù…Ø¤Ù‚Øª</button>
      <button class="btn btn-primary" onclick="resumeRecording()">Ø§Ø³ØªØ¦Ù†Ø§Ù</button>
      <button class="btn btn-danger" onclick="stopRecording()">Ø¥ÙŠÙ‚Ø§Ù</button>
    </div>
    <hr />
    <h4>ğŸ“‚ Ø§Ù„Ø£Ø±Ø´ÙŠÙ:</h4>
    <div id="archive"></div><script>
  let recognition;
  let isRecording = false;
  let finalTranscript = '';
  let lastPhrase = '';
  let timerInterval;
  let seconds = 0;

  function startTimer() {
    seconds = 0;
    document.getElementById('timer').innerText = seconds;
    timerInterval = setInterval(() => {
      seconds++;
      document.getElementById('timer').innerText = seconds;
    }, 1000);
  }

  function stopTimer() {
    clearInterval(timerInterval);
  }

  function startRecording() {
    if (!('webkitSpeechRecognition' in window)) {
      alert('Ù…ØªØµÙØ­Ùƒ Ù„Ø§ ÙŠØ¯Ø¹Ù… ØªØ­ÙˆÙŠÙ„ Ø§Ù„ØµÙˆØª Ø¥Ù„Ù‰ Ù†Øµ');
      return;
    }

    recognition = new webkitSpeechRecognition();
    recognition.lang = 'ar-SA';
    recognition.continuous = true;
    recognition.interimResults = true;

    recognition.onresult = function (event) {
      let interimTranscript = '';
      for (let i = event.resultIndex; i < event.results.length; ++i) {
        let transcript = event.results[i][0].transcript.trim();
        if (!event.results[i].isFinal) {
          interimTranscript += transcript + ' ';
        } else {
          // ÙÙ„ØªØ±Ø© Ø§Ù„ØªÙƒØ±Ø§Ø±:
          if (!finalTranscript.endsWith(transcript)) {
            finalTranscript += transcript + ' ';
          }
        }
      }
      document.getElementById('output').value = finalTranscript + interimTranscript;
    };

    recognition.onerror = function (event) {
      console.error('Ø­Ø¯Ø« Ø®Ø·Ø£:', event);
    };

    recognition.start();
    isRecording = true;
    startTimer();
  }

  function pauseRecording() {
    if (recognition && isRecording) {
      recognition.stop();
      isRecording = false;
      stopTimer();
    }
  }

  function resumeRecording() {
    if (!isRecording) {
      startRecording();
    }
  }

  function stopRecording() {
    if (recognition) {
      recognition.stop();
      isRecording = false;
      stopTimer();
      saveToArchive(finalTranscript.trim());
      finalTranscript = '';
      document.getElementById('output').value = '';
    }
  }

  function saveToArchive(text) {
    if (!text) return;
    const archive = document.getElementById('archive');
    const item = document.createElement('div');
    item.className = 'archive-item';
    const id = archive.children.length + 1;
    item.innerHTML = `${text} <br><small>#${id}</small>`;
    archive.prepend(item);
  }
</script>

  </body>
</html>