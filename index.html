<!DOCTYPE html><html lang="ar" dir="rtl">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>تحويل الصوت إلى نص</title>
  <script src="https://cdn.tailwindcss.com"></script>
</head>
<body class="bg-gray-900 text-white font-sans">
  <!-- شريط علوي -->
  <header class="bg-gray-800 px-4 py-3 flex items-center justify-between shadow">
    <button onclick="toggleSidebar()" class="text-2xl">☰</button>
    <h1 class="text-xl font-bold">محوّل الصوت إلى نص</h1>
  </header>  <!-- خلفية شفافة عند فتح الشريط الجانبي -->  <div id="backdrop" onclick="closeSidebar()" class="hidden fixed inset-0 bg-black bg-opacity-30 z-40"></div>  <!-- القائمة الجانبية -->  <aside id="sidebar" class="fixed top-0 right-0 w-64 h-full bg-gray-800 shadow-lg transform transition-transform duration-300 translate-x-full z-50">
    <div class="p-4">
      <h2 class="text-lg font-semibold mb-4">📁 الأرشيف</h2>
      <ul id="archiveList" class="space-y-2 max-h-[80vh] overflow-y-auto">
        <li class="text-gray-400">لا يوجد محفوظات بعد.</li>
      </ul>
    </div>
  </aside>  <!-- المحتوى الرئيسي -->  <main class="max-w-3xl mx-auto px-4 py-6">
    <div class="mb-6">
      <h2 class="text-2xl font-semibold mb-4">ابدأ التسجيل</h2>
      <div id="output" class="bg-gray-800 p-4 rounded shadow min-h-[150px] text-lg"></div>
      <div id="timer" class="mt-2 text-yellow-400">المدة: 0 ثانية</div>
    </div><div class="flex flex-wrap justify-center gap-4 mt-6">
  <button onclick="startRecording()" class="px-6 py-2 rounded bg-green-600 hover:bg-green-500">🎤 بدء</button>
  <button onclick="pauseRecording()" class="px-6 py-2 rounded bg-yellow-600 hover:bg-yellow-500">⏸️ إيقاف مؤقت</button>
  <button onclick="resumeRecording()" class="px-6 py-2 rounded bg-blue-600 hover:bg-blue-500">▶️ استئناف</button>
  <button onclick="stopRecording()" class="px-6 py-2 rounded bg-red-700 hover:bg-red-600">⏹️ إيقاف</button>
</div>

  </main>  <script>
    let recognition;
    let startTime;
    let timerInterval;
    let isPaused = false;
    let recordedText = "";
    let archive = JSON.parse(localStorage.getItem("transcripts")) || [];

    window.onload = function () {
      updateArchiveList();
    };

    function toggleSidebar() {
      const sidebar = document.getElementById("sidebar");
      const backdrop = document.getElementById("backdrop");

      if (sidebar.classList.contains("translate-x-full")) {
        sidebar.classList.remove("translate-x-full");
        sidebar.classList.add("translate-x-0");
        backdrop.classList.remove("hidden");
      } else {
        sidebar.classList.add("translate-x-full");
        sidebar.classList.remove("translate-x-0");
        backdrop.classList.add("hidden");
      }
    }

    function closeSidebar() {
      const sidebar = document.getElementById("sidebar");
      const backdrop = document.getElementById("backdrop");
      sidebar.classList.add("translate-x-full");
      sidebar.classList.remove("translate-x-0");
      backdrop.classList.add("hidden");
    }

    function updateArchiveList() {
      const list = document.getElementById("archiveList");
      list.innerHTML = "";
      if (archive.length === 0) {
        list.innerHTML = '<li class="text-gray-400">لا يوجد محفوظات بعد.</li>';
        return;
      }
      archive.forEach((item, index) => {
        const li = document.createElement("li");
        li.className = "cursor-pointer hover:text-yellow-400";
        li.textContent = `📄 تسجيل ${index + 1}: ${item.text.slice(0, 20)}...`;
        li.onclick = () => {
          document.getElementById("output").innerText = item.text;
          closeSidebar();
        };
        list.appendChild(li);
      });
    }

    function startRecording() {
      if (!('webkitSpeechRecognition' in window)) {
        alert("متصفحك لا يدعم ميزة التعرف على الصوت");
        return;
      }

      recognition = new webkitSpeechRecognition();
      recognition.lang = "ar-SA";
      recognition.continuous = true;
      recognition.interimResults = false;

      recognition.onresult = function (event) {
        const transcript = event.results[event.results.length - 1][0].transcript;
        recordedText += transcript + " ";
        document.getElementById("output").innerText = recordedText;
      };

      recognition.onerror = function () {
        alert("حدث خطأ أثناء التسجيل");
      };

      recognition.start();
      isPaused = false;

      startTime = Date.now();
      timerInterval = setInterval(() => {
        const seconds = Math.floor((Date.now() - startTime) / 1000);
        document.getElementById("timer").innerText = `المدة: ${seconds} ثانية`;
      }, 1000);
    }

    function pauseRecording() {
      if (recognition) {
        recognition.stop();
        isPaused = true;
        clearInterval(timerInterval);
      }
    }

    function resumeRecording() {
      if (!('webkitSpeechRecognition' in window)) {
        alert("متصفحك لا يدعم ميزة التعرف على الصوت");
        return;
      }

      if (!isPaused) return;

      recognition = new webkitSpeechRecognition();
      recognition.lang = "ar-SA";
      recognition.continuous = true;
      recognition.interimResults = false;

      recognition.onresult = function (event) {
        const transcript = event.results[event.results.length - 1][0].transcript;
        recordedText += transcript + " ";
        document.getElementById("output").innerText = recordedText;
      };

      recognition.start();
      isPaused = false;

      startTime = Date.now();
      timerInterval = setInterval(() => {
        const seconds = Math.floor((Date.now() - startTime) / 1000);
        document.getElementById("timer").innerText = `المدة: ${seconds} ثانية`;
      }, 1000);
    }

    function stopRecording() {
      if (recognition) {
        recognition.stop();
        clearInterval(timerInterval);
      }

      const finalText = recordedText.trim();
      if (finalText) {
        archive.push({ text: finalText, time: new Date().toISOString() });
        localStorage.setItem("transcripts", JSON.stringify(archive));
        updateArchiveList();
      }

      recordedText = "";
      document.getElementById("output").innerText = "";
    }
  </script></body>
</html>