<!DOCTYPE html>
<html lang="ar" dir="rtl">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Ù…Ø­ÙˆÙ„ Ø§Ù„ØµÙˆØª Ø¥Ù„Ù‰ Ù†Øµ</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://unpkg.com/addtoany@1.1/addtoany.min.js" defer></script>
    <style>
      body { font-family: system-ui, sans-serif; }
    </style>
  </head>
  <body class="bg-gray-900 text-white min-h-screen flex flex-col">
    <!-- ğŸ” Ø§Ù„Ø´Ø±ÙŠØ· Ø§Ù„Ø¹Ù„ÙˆÙŠ -->
    <header class="p-4 flex justify-between items-center bg-gray-800">
      <h1 class="text-xl font-bold">ğŸ¤ Ù…Ø­ÙˆÙ„ Ø§Ù„ØµÙˆØª Ø¥Ù„Ù‰ Ù†Øµ</h1>
      <button id="drawerBtn" class="text-2xl">â˜°</button>
    </header>

    <!-- ğŸ“‹ Ø§Ù„Ø´Ø±ÙŠØ· Ø§Ù„Ø¬Ø§Ù†Ø¨ÙŠ -->
    <aside id="drawer" class="fixed top-0 right-0 bg-gray-800 h-full w-64 p-4 transform translate-x-full transition-transform duration-300 z-50">
      <h2 class="text-lg font-bold mb-2">ğŸ“‹ Ù‚Ø§Ø¦Ù…Ø©</h2>
      <p class="text-sm">Ù‡Ø°Ø§ Ø´Ø±ÙŠØ· Ø¬Ø§Ù†Ø¨ÙŠ ØªØ¬Ø±ÙŠØ¨ÙŠ Ù„Ù„Ø²ÙŠÙ†Ø© ÙÙ‚Ø·.</p>
    </aside>
    <div id="overlay" class="fixed inset-0 bg-black bg-opacity-50 hidden z-40"></div>

    <!-- ğŸ§  Ø§Ù„Ù…Ø­ØªÙˆÙ‰ Ø§Ù„Ø±Ø¦ÙŠØ³ÙŠ -->
    <main class="flex-1 p-4 space-y-4">
      <div class="text-sm text-gray-400" id="timer">Ø§Ù„Ù…Ø¯Ø©: 0 Ø«Ø§Ù†ÙŠØ©</div>
      <div class="flex gap-4">
        <button id="startBtn" class="bg-blue-600 px-4 py-2 rounded hover:bg-blue-700">Ø§Ø¨Ø¯Ø£ Ø§Ù„ØªØ³Ø¬ÙŠÙ„</button>
        <button id="stopBtn" class="bg-red-600 px-4 py-2 rounded hover:bg-red-700">Ø¥ÙŠÙ‚Ø§Ù Ø§Ù„ØªØ³Ø¬ÙŠÙ„</button>
      </div>
      <section id="archive" class="mt-6 space-y-2"></section>
    </main>

    <!-- ğŸ“¢ Ø²Ø± Ø§Ù„Ù…Ø´Ø§Ø±ÙƒØ© -->
    <footer class="p-4 bg-gray-800 text-center mt-auto">
      <div class="a2a_kit a2a_kit_size_32 a2a_default_style flex justify-center gap-3">
        <a class="a2a_button_whatsapp"></a>
        <a class="a2a_button_facebook"></a>
        <a class="a2a_button_twitter"></a>
        <a class="a2a_button_telegram"></a>
      </div>
    </footer>

    <!-- ğŸ¯ Ø§Ù„Ø¨Ø±Ù…Ø¬Ø© -->
    <script>
      document.addEventListener("DOMContentLoaded", () => {
        const startBtn = document.getElementById("startBtn");
        const stopBtn = document.getElementById("stopBtn");
        const timerEl = document.getElementById("timer");
        const archive = document.getElementById("archive");
        const drawerBtn = document.getElementById("drawerBtn");
        const drawer = document.getElementById("drawer");
        const overlay = document.getElementById("overlay");

        let mediaRecorder;
        let chunks = [];
        let timer;
        let seconds = 0;

        // â±ï¸ Ø§Ù„Ø¹Ø¯Ø§Ø¯
        const startTimer = () => {
          timer = setInterval(() => {
            seconds++;
            timerEl.textContent = `Ø§Ù„Ù…Ø¯Ø©: ${seconds} Ø«Ø§Ù†ÙŠØ©`;
          }, 1000);
        };
        const stopTimer = () => clearInterval(timer);

        // ğŸ“ ØªØ­Ù…ÙŠÙ„ Ø§Ù„Ø£Ø±Ø´ÙŠÙ
        let saved = JSON.parse(localStorage.getItem("records") || "[]");
        let counter = saved.length;
        renderArchive();

        // â–¶ï¸ Ø¨Ø¯Ø¡ Ø§Ù„ØªØ³Ø¬ÙŠÙ„
        startBtn.addEventListener("click", async () => {
          chunks = [];
          seconds = 0;
          timerEl.textContent = "Ø§Ù„Ù…Ø¯Ø©: 0 Ø«Ø§Ù†ÙŠØ©";

          const stream = await navigator.mediaDevices.getUserMedia({ audio: true });
          mediaRecorder = new MediaRecorder(stream);

          mediaRecorder.ondataavailable = (e) => chunks.push(e.data);
          mediaRecorder.onstop = () => {
            stopTimer();
            const blob = new Blob(chunks, { type: "audio/webm" });
            const reader = new FileReader();
            reader.onloadend = () => {
              const transcript = prompt("Ø§ÙƒØªØ¨ Ø§Ù„Ù†Øµ Ø§Ù„Ù…Ø³ØªÙ†ØªØ¬ Ø£Ùˆ Ø¹Ø¯Ù‘Ù„Ù‡:", "");
              if (transcript) {
                saved.unshift({ text: transcript });
                localStorage.setItem("records", JSON.stringify(saved));
                renderArchive();
              }
            };
            reader.readAsDataURL(blob);
          };

          mediaRecorder.start();
          startTimer();
        });

        // â›” Ø¥ÙŠÙ‚Ø§Ù Ø§Ù„ØªØ³Ø¬ÙŠÙ„
        stopBtn.addEventListener("click", () => {
          if (mediaRecorder && mediaRecorder.state !== "inactive") {
            mediaRecorder.stop();
          }
        });

        // ğŸ“œ Ø¹Ø±Ø¶ Ø§Ù„Ø£Ø±Ø´ÙŠÙ
        function renderArchive() {
          archive.innerHTML = "";
          saved.forEach((item, index) => {
            const i = saved.length - index;
            const div = document.createElement("div");
            div.className = "p-2 border-b border-gray-700 flex justify-between items-center gap-2";
            div.innerHTML = `
              <span class="text-sm flex-1 cursor-pointer hover:underline" onclick="editText(${index})">${item.text}</span>
              <div class="flex items-center gap-2">
                <button onclick="downloadText(${index})" class="text-green-400">ğŸ“¥</button>
                <button onclick="deleteText(${index})" class="text-red-400">ğŸ—‘ï¸</button>
                <span class="text-gray-500 text-xs">${i}</span>
              </div>`;
            archive.appendChild(div);
          });
        }

        // â˜° Ø§Ù„Ù‚Ø§Ø¦Ù…Ø© Ø§Ù„Ø¬Ø§Ù†Ø¨ÙŠØ©
        drawerBtn.addEventListener("click", () => {
          drawer.classList.remove("translate-x-full");
          overlay.classList.remove("hidden");
        });
        overlay.addEventListener("click", () => {
          drawer.classList.add("translate-x-full");
          overlay.classList.add("hidden");
        });

        // âœï¸ ØªØ¹Ø¯ÙŠÙ„ Ù†Øµ
        window.editText = function (index) {
          const newText = prompt("Ø¹Ø¯Ù‘Ù„ Ø§Ù„Ù†Øµ:", saved[index].text);
          if (newText !== null) {
            saved[index].text = newText;
            localStorage.setItem("records", JSON.stringify(saved));
            renderArchive();
          }
        };

        // ğŸ“¥ ØªØ­Ù…ÙŠÙ„ Ù†Øµ
        window.downloadText = function (index) {
          const blob = new Blob([saved[index].text], { type: "text/plain;charset=utf-8" });
          const a = document.createElement("a");
          a.href = URL.createObjectURL(blob);
          a.download = `ØªØ³Ø¬ÙŠÙ„_${index + 1}.txt`;
          a.click();
        };

        // ğŸ—‘ï¸ Ø­Ø°Ù
        window.deleteText = function (index) {
          if (confirm("Ù‡Ù„ Ø£Ù†Øª Ù…ØªØ£ÙƒØ¯ Ù…Ù† Ø­Ø°Ù Ù‡Ø°Ø§ Ø§Ù„ØªØ³Ø¬ÙŠÙ„ØŸ")) {
            saved.splice(index, 1);
            localStorage.setItem("records", JSON.stringify(saved));
            renderArchive();
          }
        };
      });
    </script>
  </body>
</html>